---
layout: post
title: "Kubernetes Node"
author: "Bys"
category: k8s
date: 2023-05-08 01:00:00
tags: kubernetes node
---

# [Kubernetes Node](https://kubernetes.io/docs/concepts/architecture/nodes/)

## [Node Management]()
ë…¸ë“œì˜ 3ê°€ì§€ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 
  - kubelet
  - container runtime
  - kube-proxy

<br>

API ì„œë²„ì— ë…¸ë“œë¥¼ ë“±ë¡í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²„ì´ ì¡´ì¬í•˜ë©° ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ì€ ì‹ ê·œ ë…¸ë“œê°€ ìœ íš¨í•œì§€ í™•ì¸í•œë‹¤.  
  - The kubelet on a node self-registers to the control plane (--register-node)
    - Self registerëŠ” ë…¸ë“œ ë“±ë¡ì‹œ ìì‹ ì˜ ê°€ìš©í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìë™ìœ¼ë¡œ reportí•œë‹¤.  
  - Manually add a Node object
    - Manualë¡œ ë“±ë¡í•  ê²½ìš° nodeì˜ capacity ì •ë³´ë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤.  

<br>


ë…¸ë“œ ë„¤ì„ì€ ë°˜ë“œì‹œ Unique í•´ì•¼ í•œë‹¤.  
  - Two Nodes cannot have the same name at the same time. 

<br>

Self-registration of Nodes 
  - When the kubelet flag --register-node is true (the default), the kubelet will attempt to register itself with the API server.
  For self-registration, the kubelet is started with the following options:
  - --kubeconfig - Path to credentials to authenticate itself to the API server.
  - --cloud-provider - How to talk to a cloud provider to read metadata about itself.
  - --register-node - Automatically register with the API server. (Default: true)
  - --register-with-taints - Register the node with the given list of taints (comma separated <key>=<value>:<effect>). No-operation if register-node is false.
  - --node-ip - Optional comma-separated list of the IP addresses for the node. You can only specify a single address for each address family. For example, in a single-stack IPv4 cluster, you set this value to be the IPv4 address that the kubelet should use for the node. See configure     IPv4/IPv6 dual stack for details of running a dual-stack cluster. If you don't provide this argument, the kubelet uses the node's default IPv4 address, if any; if the node has no IPv4 addresses then the kubelet uses the node's default IPv6 address.
  - --node-labels - Labels to add when registering the node in the cluster (see label restrictions enforced by the NodeRestriction admission plugin).
  - --node-status-update-frequency - Specifies how often kubelet posts its node status to the API server. (Default: 10s)

  - `EKS kubelet v1.24 on data-plane`  
    ```bash
    usr/bin/kubelet
    --config /etc/kubernetes/kubelet/kubelet-config.json
    --kubeconfig /var/lib/kubelet/kubeconfig
    --container-runtime-endpoint unix:///run/containerd/containerd.sock
    --image-credential-provider-config /etc/eks/ecr-credential-provider/ecr-credential-provider-config
    --image-credential-provider-bin-dir /etc/eks/ecr-credential-provider
    --node-ip=10.20.11.32
    --pod-infra-container-image=602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/eks/pause:3.5
    --v=2
    --cloud-provider=aws
    --container-runtime=remote
    --node-labels=eks.amazonaws.com/sourceLaunchTemplateVersion=1,alpha.eksctl.io/nodegroup-name=ng-v1,alpha.eksctl.io/cluster-name=bys-dev-eks-main,eks.amazonaws.com/nodegroup-image=ami-0fdcb707922882aef,eks.amazonaws.com/capacityType=ON_DEMAND,eks.amazonaws.com/nodegroup=ng-v1,eks.amazonaws.com/sourceLaunchTemplateId=lt-0cbd44d881bbbe60f
    --max-pods=29
    ```
  
  <br>


Node authorization mode, NodeRestriction admission pluginì´ í™œì„±í™” ë˜ë©´ kubeletì€ ìì‹ ì˜ ë…¸ë“œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ìƒì„±/ìˆ˜ì • ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì¸ê°€ëœë‹¤.  
- NodeRestriction
  - Admission controllerê°€ kubeletì´ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” Nodeì™€ Podë¥¼ ì œí•œí•œë‹¤. Admission controllerì— ì˜í•œ ì œì–´ê°€ ê°€ëŠ¥í•˜ë ¤ë©´ kubeletì€ ë°˜ë“œì‹œ system:nodes ê·¸ë£¹ì˜ credentialì„ ì´ìš©í•´ì•¼í•˜ë©° usernameìœ¼ë¡œëŠ” system:node:<nodeName>ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.  

The Node authorizerëŠ” kubeletì´ APIë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í—ˆê°€í•´ì£¼ë©° ë‹¤ìŒ ê¶Œí•œì„ í¬í•¨í•œë‹¤.
- Read operations:
  - services
  - endpoints
  - nodes
  - pods
  - secrets, configmaps, persistent volume claims and persistent volumes related to pods bound to the kubelet's node

- Write operations:
  - nodes and node status (enable the NodeRestriction admission plugin to limit a kubelet to modify its own node)
  - pods and pod status (enable the NodeRestriction admission plugin to limit a kubelet to modify pods bound to itself)
  - events

- Auth-related operations:
  - read/write access to the CertificateSigningRequests API for TLS bootstrapping
  - the ability to create TokenReviews and SubjectAccessReviews for delegated authentication/authorization checks


<br><br>

## Node Status
ë…¸ë“œì˜ ìƒíƒœëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•œë‹¤.  

- Addresses  
  ```bash
  Addresses:
    InternalIP:   10.20.10.208
    Hostname:     ip-10-20-10-208.ap-northeast-2.compute.internal
    InternalDNS:  ip-10-20-10-208.ap-northeast-2.compute.internal
  ```

  - HostName: The hostname as reported by the node's kernel. Can be overridden via the kubelet --hostname-override parameter.
  - ExternalIP: Typically the IP address of the node that is externally routable (available from outside the cluster).
  - InternalIP: Typically the IP address of the node that is routable only within the cluster.

- Conditions  
  ë…¸ë“œì˜ Conditionì€ ë…¸ë“œ ë¦¬ì†ŒìŠ¤ì˜ `.status`ì— ì˜í•´ì„œ ìƒíƒœê°€ í‘œì‹œë˜ì–´ì§„ë‹¤.  
  ë§Œì•½ ë…¸ë“œì˜ Status ìƒíƒœê°€ Unknown ë˜ëŠ” False ìƒíƒœë¡œ kube-controller-managerì˜ NodeMonitorGracePeriod ì„¤ì • ì‹œê°„ë³´ë‹¤ ê¸¸ê²Œ ìœ ì§€ë˜ë©´ Unknown statusì— ëŒ€í•´ì„œëŠ” node.kubernetes.io/unreachable taintê°€ False statusì— ëŒ€í•´ì„œëŠ” node.kubernetes.io/not-ready taintê°€ ì¶”ê°€ ëœë‹¤.  
  ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë…¸ë“œë¥¼ Podì— í• ë‹¹í•  ë•Œ taintë¥¼ ê³ ë ¤í•˜ë¯€ë¡œ ì´ëŸ¬í•œ taintëŠ” Pending ìƒíƒœì˜ íŒŒë“œì—ë„ ì˜í–¥ì„ ë¯¸ì¹œë‹¤. ì´ë¯¸ ë…¸ë“œì— ìŠ¤ì¼€ì¥´ëœ íŒŒë“œë“¤ì€ NoExecute taintì— ì˜í•´ì„œ Evicted ë  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ íŠ¹ì • ë…¸ë“œì˜ taintì—ë„ ë¶ˆêµ¬í•˜ê³  íŒŒë“œì˜ tolerationì„¤ì •ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ Running í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.  
  ```bash
  Conditions:
    Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
    ----             ------  -----------------                 ------------------                ------                       -------
    Ready            True    Mon, 01 May 2023 16:38:39 +0900   Tue, 25 Apr 2023 14:22:34 +0900   KubeletReady                 kubelet is posting ready status
    MemoryPressure   False   Mon, 01 May 2023 16:38:39 +0900   Tue, 25 Apr 2023 14:21:38 +0900   KubeletHasSufficientMemory   kubelet has sufficient memory available
    DiskPressure     False   Mon, 01 May 2023 16:38:39 +0900   Tue, 25 Apr 2023 14:21:38 +0900   KubeletHasNoDiskPressure     kubelet has no disk pressure
    PIDPressure      False   Mon, 01 May 2023 16:38:39 +0900   Tue, 25 Apr 2023 14:21:38 +0900   KubeletHasSufficientPID      kubelet has sufficient PID available
  ```

  - Ready  
    - True if the node is healthy and ready to accept pods
    - False if the node is not healthy and is not accepting pods
    - Unknown if the node controller has not heard from the node in the last node-monitor-grace-period (default is 40 seconds)
  
  - DiskPressure	
    - True if pressure exists on the disk sizeâ€”that is, if the disk capacity is low; otherwise False
  
  - MemoryPressure	
    - True if pressure exists on the node memoryâ€”that is, if the node memory is low; otherwise False
  
  - PIDPressure	
    - True if pressure exists on the processesâ€”that is, if there are too many processes on the node; otherwise False
  
  - NetworkUnavailable	
    - True if the network for the node is not correctly configured, otherwise False

- Capacity and Allocatable  
  CPU, Memory, MaxPods, pods ë“±ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë³´ì—¬ì£¼ë©° CapacityëŠ” ë…¸ë“œì˜ ì´ ê°€ìš©í•œ ë¦¬ì†ŒìŠ¤ë¥¼, Allocatableì€ ì¼ë°˜ì ì¸ íŒŒë“œì˜ ê²½ìš°ì¼ ë•Œ ì‚¬ìš©ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ë³´ì—¬ì¤€ë‹¤.  

  ```bash
  Capacity:
    attachable-volumes-aws-ebs:  25
    attachable-volumes-aws-ebs:  39
    cpu:                         4
    ephemeral-storage:           52416492Ki
    hugepages-1Gi:               0
    hugepages-2Mi:               0
    memory:                      16078024Ki
    pods:                        20
    vpc.amazonaws.com/pod-eni:   39
  Allocatable:
    attachable-volumes-aws-ebs:  39
    cpu:                         3920m
    ephemeral-storage:           47233297124
    hugepages-1Gi:               0
    hugepages-2Mi:               0
    memory:                      15387848Ki
    pods:                        20
    vpc.amazonaws.com/pod-eni:   39
  ```

- Info
  Kernel Version, Kubernetes version Container runtime details ë“± ë…¸ë“œì˜ ì¼ë°˜ì ì¸ ì •ë³´ë¥¼ ë³´ì—¬ì¤€ë‹¤.
  ```bash
  System Info:
    Machine ID:                 ec2ee61571b85e94fce9e922a86d214e
    System UUID:                ec2ee615-71b8-5e94-fce9-e922a86d214e
    Boot ID:                    033e9dca-6b6c-4370-8ac0-928685fc004d
    Kernel Version:             5.10.176-157.645.amzn2.x86_64
    OS Image:                   Amazon Linux 2
    Operating System:           linux
    Architecture:               amd64
    Container Runtime Version:  containerd://1.6.19
    Kubelet Version:            v1.25.7-eks-a59e1f0
    Kube-Proxy Version:         v1.25.7-eks-a59e1f0
  ```

<br><br>

## Heartbeats  
Kubernetes ë…¸ë“œì— ì˜í•´ ì „ì†¡ë˜ëŠ” HeartbeatsëŠ” í´ëŸ¬ìŠ¤í„°ê°€ ë…¸ë“œê°€ ê°€ìš©í•œì§€ ê²°ì •í•˜ëŠ”ë° ë„ì›€ì„ ì£¼ë©° ì¥ì• ê°€ ê°ì§€ë˜ì—ˆì„ ë•Œ ì–´ë–¤ ì¡°ì¹˜ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.  

HeartbeatsëŠ” ë‘ ê°€ì§€ í˜•íƒœê°€ ì¡´ì¬í•œë‹¤.
  - Updates to the .status of a Node
  - Lease objects within the kube-node-lease namespace. Each Node has an associated Lease object.
    - Lease ê°ì²´ë¥¼ í†µí•œ í—¬ìŠ¤ ì²´í¬ëŠ” 1.14 ë²„ì „ ì´ í›„ Defaultë¡œ 
  
ë…¸ë“œì˜ `.status`ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì— ë¹„í•´ LeaseëŠ” ê°€ë²¼ìš´ ë¦¬ì†ŒìŠ¤ì´ë‹¤. Heartbeatsë¥¼ ìœ„í•´ Leasesë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê·œëª¨ê°€ í° í´ëŸ¬ìŠ¤í„°ì—ì„œ ì„±ëŠ¥ì— ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.  

Kubeletì€ ë…¸ë“œì˜ `.status`ë¥¼ ìƒì„±í•˜ê³  ì—…ë°ì´íŠ¸ë¥¼ ë‹´ë‹¹í•˜ë©° ê´€ë ¨ëœ Leaseë“¤ì˜ ì—…ë°ì´íŠ¸ë¥¼ ë‹´ë‹¹í•œë‹¤.   
  > The kubelet is responsible for creating and updating the .status of Nodes, and for updating their related Leases.
  
  - Kubeletì€ 10ì´ˆ ì£¼ê¸°ë¡œ(nodeStatusUpdateFrequency) ë…¸ë“œì˜ ìƒíƒœ ê°’ì„ í™•ì¸í•˜ë©° 5ë¶„ ì£¼ê¸°ë¡œ(nodeStatusReportFrequency) APIì„œë²„ë¡œ ë…¸ë“œ ìƒíƒœ ê°’ì„ ë³´ê³ í•œë‹¤. statusì— ë³€í™”ê°€ ìˆì„ ë•ŒëŠ” nodeStatusReportFrequency ì£¼ê¸°ê°€ ë¬´ì‹œë˜ë©°, ì„¤ì •ëœ intervalë™ì•ˆ statusì— ì—…ë°ì´íŠ¸ê°€ ì—†ì„ ë•Œ `.status`ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë…¸ë“œì— .status ì—…ë°ì´íŠ¸ë¥¼ í•˜ëŠ” ì£¼ê¸°ëŠ” 5 ë¶„ì´ë©° ë…¸ë“œê°€ Unreachableì´ ë˜ëŠ” ê¸°ë³¸ ì‹œê°„ 40ì´ˆ ë³´ë‹¤ í›¨ì”¬ ê¸¸ë‹¤.  
    > The kubelet updates the node's .status either when there is change in status or if there has been no update for a configured interval. The default interval for .status updates to Nodes is 5 minutes, which is much longer than the 40 second default timeout for unreachable nodes.
  - Kubeletì€ ìì‹ ì˜ Lease ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë§¤ 10ì´ˆ(Defaultì„¤ì •) ë§ˆë‹¤ ì—…ë°ì´íŠ¸í•œë‹¤. Lease ì—…ë°ì´íŠ¸ëŠ” ë…¸ë“œì˜ `.status` ì—…ë°ì´íŠ¸ì™€ëŠ” ë…ë¦½ì ì´ë‹¤. ë§Œì•½ Lease ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í•˜ë©´ kubeletì€ ì¬ì‹œë„í•˜ë©° 200 ë°€ë¦¬ì´ˆì˜ exponential backoff ë° 7ì´ˆì˜ ìƒí•œì„ ê°€ì§€ê³  ì¬ ì‹œë„í•œë‹¤.  
    > The kubelet creates and then updates its Lease object every 10 seconds (the default update interval). Lease updates occur independently from updates to the Node's .status. If the Lease update fails, the kubelet retries, using exponential backoff that starts at 200 milliseconds and capped at 7 seconds.
  - Kubeletì˜ ê¶Œí•œë¬¸ì œë¡œ ì¸í•´ Leaseë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ëª»í•  ê²½ìš°ì˜ kubelet ë¡œê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.  
  ```log
  Sep 27 08:07:05 ip-10-20-42-209.ap-northeast-2.compute.internal kubelet[2950]: E0927 08:07:05.536991    2950 controller.go:146] "Failed to ensure lease exists, will retry" err="leases.coordination.k8s.io \"ip-10-20-42-209.ap-northeast-2.compute.internal\" is forbidden: User \"WorkerNode\" cannot get resource \"leases\" in API group \"coordination.k8s.io\" in the namespace \"kube-node-lease\"" interval="7s"
  Sep 27 08:07:07 ip-10-20-42-209.ap-northeast-2.compute.internal kubelet[2950]: E0927 08:07:07.672774    2950 webhook.go:154] Failed to make webhook authenticator request: tokenreviews.authentication.k8s.io is forbidden: User "WorkerNode" cannot create resource "tokenreviews" in API group "authentication.k8s.io" at the cluster scope
  ```


```bash
$ kubectl get lease -n kube-node-lease
NAME                                                      HOLDER                                                    AGE
fargate-ip-10-20-10-162.ap-northeast-2.compute.internal   fargate-ip-10-20-10-162.ap-northeast-2.compute.internal   118d
fargate-ip-10-20-10-38.ap-northeast-2.compute.internal    fargate-ip-10-20-10-38.ap-northeast-2.compute.internal    16h
fargate-ip-10-20-15-189.ap-northeast-2.compute.internal   fargate-ip-10-20-15-189.ap-northeast-2.compute.internal   118d
fargate-ip-10-20-15-226.ap-northeast-2.compute.internal   fargate-ip-10-20-15-226.ap-northeast-2.compute.internal   118d
ip-10-20-10-112.ap-northeast-2.compute.internal           ip-10-20-10-112.ap-northeast-2.compute.internal           11d
ip-10-20-10-208.ap-northeast-2.compute.internal           ip-10-20-10-208.ap-northeast-2.compute.internal           6d2h
ip-10-20-10-51.ap-northeast-2.compute.internal            ip-10-20-10-51.ap-northeast-2.compute.internal            173d
ip-10-20-10-62.ap-northeast-2.compute.internal            ip-10-20-10-62.ap-northeast-2.compute.internal            73d
ip-10-20-11-100.ap-northeast-2.compute.internal           ip-10-20-11-100.ap-northeast-2.compute.internal           73d
ip-10-20-11-132.ap-northeast-2.compute.internal           ip-10-20-11-132.ap-northeast-2.compute.internal           2d1h
ip-10-20-11-135.ap-northeast-2.compute.internal           ip-10-20-11-135.ap-northeast-2.compute.internal           33d
ip-10-20-11-32.ap-northeast-2.compute.internal            ip-10-20-11-32.ap-northeast-2.compute.internal            11d
ip-10-20-11-9.ap-northeast-2.compute.internal             ip-10-20-11-9.ap-northeast-2.compute.internal             73d
ip-10-20-20-79.ap-northeast-2.compute.internal            ip-10-20-20-79.ap-northeast-2.compute.internal            25h
```

Lease ê°ì²´ë¥¼ Describe í•˜ë©´ specì— Renew Timeì´ ì¡´ì¬í•˜ë©° ì •ìƒì ì¸ ë…¸ë“œì˜ ê²½ìš° 10ì´ˆ ê°„ê²©ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ëœë‹¤.  
```bash
kd lease ip-10-20-20-79.ap-northeast-2.compute.internal -n kube-node-lease
Name:         ip-10-20-20-79.ap-northeast-2.compute.internal
Namespace:    kube-node-lease
Labels:       <none>
Annotations:  <none>
API Version:  coordination.k8s.io/v1
Kind:         Lease
Metadata:
  Creation Timestamp:  2023-04-30T07:17:09Z
  Owner References:
    API Version:     v1
    Kind:            Node
    Name:            ip-10-20-20-79.ap-northeast-2.compute.internal
    UID:             e42b805e-d7e4-4682-b907-6716e628d1bc
  Resource Version:  93730810
  UID:               77736a12-626c-43da-bf71-9c616bfbf121
Spec:
  Holder Identity:         ip-10-20-20-79.ap-northeast-2.compute.internal
  Lease Duration Seconds:  40
  Renew Time:              2023-05-01T08:31:18.434194Z
Events:                    <none>
```

ëª¨ë“  Kubelet heartbeatëŠ” Lease ê°ì²´ì— ëŒ€í•œ ì—…ë°ì´íŠ¸ ìš”ì²­ì´ë©° Leaseê°ì²´ì˜ spec.renewTime í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤. Kubernetes control planeì€ ì´ time stampë¥¼ ì´ìš©í•˜ì—¬ ë…¸ë“œì˜ ê°€ìš©ì„±ì„ ê²°ì •í•œë‹¤.  
> Under the hood, every kubelet heartbeat is an update request to this Lease object, updating the spec.renewTime field for the Lease. The Kubernetes control plane uses the time stamp of this field to determine the availability of this Node

<br><br>

## Reserve Compute Resources
íŒŒë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë…¸ë“œì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ ìš©ëŸ‰ì„ ì†Œë¹„í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ë…¸ë“œëŠ” OS ë° ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ìœ„í•œ ëª‡ ê°€ì§€ System Daemonì„ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤. System Daemon í”„ë¡œì„¸ìŠ¤ë“¤ì— ëŒ€í•´ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë³„ë„ë¡œ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ íŒŒë“œì™€ System Daemonë“¤ì€ ë¦¬ì†ŒìŠ¤ ê²½ìŸì„ í•˜ê²Œ ë˜ë©° ë…¸ë“œì—ì„œ ë¦¬ì†ŒìŠ¤ ë¶€ì¡± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.  
Kubeletì—ì„œëŠ” Node Allocatable ì´ë¼ê³  í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ë©° System Daemonë“¤ì— ëŒ€í•œ ë¦¬ì†ŒìŠ¤ ì˜ˆì•½ì„ ë„ì™€ì¤€ë‹¤.  

ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œì—ì„œ Allocatableì˜ ì •ì˜ëŠ” íŒŒë“œê°€ ì‚¬ìš©ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ì˜ ì–‘ìœ¼ë¡œ ì •ì˜í•˜ë©° ì•„ë˜ describe nodeë¥¼ í†µí•´ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.  
```bash
$ kubectl describe node ip-10-20-11-44.ap-northeast-2.compute.internal
......ìƒëµ
Allocatable:
  cpu:                        1930m
  ephemeral-storage:          76224326324
  hugepages-1Gi:              0
  hugepages-2Mi:              0
  memory:                     7220180Ki
  pods:                       29
  vpc.amazonaws.com/pod-eni:  9
```

- kube-reserved
kube-reservedëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œìŠ¤í…œ ë°ëª¬ì´ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì˜ˆì•½ì„ ì˜ë¯¸í•˜ë©° ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œìŠ¤í…œ ë°ëª¬ìœ¼ë¡œëŠ” kubelet, container runtime, node problem detector ë“±ì´ ì¡´ì¬í•œë‹¤. kube-reservedëŠ” íŒŒë“œë¡œ ì‹¤í–‰ë˜ëŠ” ì‹œìŠ¤í…œ ë°ëª¬ì˜ ë¦¬ì†ŒìŠ¤ ì˜ˆì•½ì„ ì˜ë¯¸í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë©° ë…¸ë“œì˜ íŒŒë“œ ë°€ë„ í•¨ìˆ˜ì´ë‹¤.  

- system-reserved
system-reserved OS ì‹œìŠ¤í…œ ë°ëª¬ì´ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì˜ˆì•½ì„ ì˜ë¯¸í•˜ë©° OS ì‹œìŠ¤í…œ ë°ëª¬ìœ¼ë¡œëŠ” sshd, udev, ë“±ì´ ì¡´ì¬í•œë‹¤. kernel ë©”ëª¨ë¦¬ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ íŒŒë“œë¡œ ê°„ì£¼ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— system-reservedëŠ” kernelì„ ìœ„í•œ ë©”ëª¨ë¦¬ë„ ì˜ˆì•½í•´ì•¼ í•œë‹¤. ë˜í•œ ì‚¬ìš©ì ë¡œê·¸ì¸ ì„¸ì…˜ì„ ìœ„í•¸ ë¦¬ì†ŒìŠ¤ ì˜ˆì•½ë„ í•„ìš”í•˜ë‹¤.  

- Eviction Thresholds
ë…¸ë“œë ˆë²¨ì—ì„œ ë©”ëª¨ë¦¬ ì••ë°•(pressure)ì€ OOMì„ ìœ ë°œì‹œí‚¤ë©° ì´ëŠ” ë…¸ë“œì—ì„œ ì‹¤í–‰ì¤‘ì¸ ì „ì²´ íŒŒë“œ ë° ë…¸ë“œì— ì˜í–¥ì„ ì£¼ê²Œ ëœë‹¤. ì´ì— ë”°ë¼ ë…¸ë“œëŠ” ë©”ëª¨ë¦¬ê°€ íšŒìˆ˜ ë  ë•Œ ê¹Œì§€ ì„ì‹œì ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ ìƒíƒœê°€ ë  ìˆ˜ ìˆë‹¤. 
ì‹œìŠ¤í…œ OOMì„ ë°©ì§€í•˜ê±°ë‚˜ ê°€ëŠ¥ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ì„œ kubeletì€ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ë¥¼ ì œê³µí•˜ë©° Evictionì€ memoryì™€ ephemeral-storageì— ëŒ€í•´ì„œë§Œ ì œê³µí•œë‹¤. `--eviction-hard` í”Œë˜ê·¸ë¥¼ í†µí•´ ì¼ë¶€ ë©”ëª¨ë¦¬ë¥¼ ì˜ˆì•½í•¨ìœ¼ë¡œì¨ kubeletì€ ë…¸ë“œì˜ ë©”ëª¨ë¦¬ ê°€ìš©ëŸ‰ì´ ì˜ˆì•½ëœ ê°’ ì•„ë˜ë¡œ ë–¨ì–´ì§ˆ ë•Œë§ˆë‹¤ íŒŒë“œë¥¼ evictí•˜ë ¤ê³  ì‹œë„í•œë‹¤.  


[`Example`](https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/#example-scenario)
- Node Resource
  - 16 CPUs
  - 32GI Memory
  - 100Gi Storage

- Scenario
  - --kube-reserved is set to cpu=1, memory=2Gi, ephemeral-storage=1Gi
  - --system-reserved is set to cpu=500m, memory=1Gi, ephemeral-storage=1Gi
  - --eviction-hard is set to memory.available<500Mi, nodefs.available<10%

ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ Allocatable ê°’ì€ CPUs: 14.5 CPUs, Memory: 28.5Gi, Storage: 88Gi ê°€ ëœë‹¤. SchedulerëŠ” ì´ë¥¼ í†µí•´ ì´ ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  íŒŒë“œì˜ ìš”ì²­ ë©”ëª¨ë¦¬ê°€ 28.5Gië¥¼ ë„˜ì„ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. 
ë˜í•œ kubeletì€ ì „ì²´ì ì¸ íŒŒë“œì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ 28.5Gië¥¼ ë„˜ì–´ì„œë©´ evictionì„ í•˜ê²Œ ëœë‹¤.  

ë§Œì•½ kube-reserved, system-reserved ì„¤ì •ì´ ë˜ì–´ìˆì§€ ì•Šê³  ì‹œìŠ¤í…œ ë°ëª¬ì´ ì˜ˆì•½ê°’ì„ ì´ˆê³¼í•˜ë©´ kubeletì€ 31.5Gi ë©”ëª¨ë¦¬, 90Gi ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰ì„ ë„˜ì„ ë•Œ ë§ˆë‹¤ íŒŒë“œë¥¼ evictioní•œë‹¤.  


<br><br>

## Kube-controller-manager(Node controller)
ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” Kubernetes Control Planeì˜ ìš”ì†Œì´ë©° ë…¸ë“œë¥¼ ë‹¤ì–‘í•œ ì¸¡ë©´ì—ì„œ ê´€ë¦¬í•œë‹¤.  

1. ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” CIDR assignment ì„¤ì •ì´ ëœ ê²½ìš° ë…¸ë“œê°€ ë“±ë¡ë  ë•Œ ë…¸ë“œì— CIDR blockì„ í• ë‹¹í•œë‹¤.  
2. ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” CSPì‚¬ì˜ available machines ë¦¬ìŠ¤íŠ¸ì˜ ìµœì‹ ì •ë³´ë¡œ ë‚´ë¶€ ë…¸ë“œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•œë‹¤.  
3. ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë…¸ë“œì˜ Health ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§ í•œë‹¤.  
   - ë…¸ë“œê°€ Unreachable ìƒíƒœê°€ ë˜ë©´ ë…¸ë“œì˜ `.status`ì˜ Ready ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤. ì´ëŸ° ê²½ìš° ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” Readyìƒíƒœë¥¼ Unknown ìƒíƒœë¡œ ë³€ê²½í•œë‹¤.  
   > In the case that a node becomes unreachable, updating the Ready condition in the Node's .status field. In this case the node controller sets the Ready condition to Unknown.

   - ë…¸ë“œê°€ Unreachable ìƒíƒœë¡œ ë‚¨ì•„ìˆìœ¼ë©´ í•´ë‹¹ ë…¸ë“œì˜ Podë“¤ì— ëŒ€í•´ì„œ [API-initiated eviction](https://kubernetes.io/docs/concepts/scheduling-eviction/api-eviction/)ì„ ì‹œì‘í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë…¸ë“œê°€ Unknown ìƒíƒœë¡œ ë§ˆí¬ë˜ê³  5ë¶„ì˜ ì‹œê°„ ë’¤ì— ì²« ë²ˆì§¸ eviction ìš”ì²­ì„ ì§„í–‰í•œë‹¤.  
   > If a node remains unreachable: triggering API-initiated eviction for all of the Pods on the unreachable node. By default, the node controller waits 5 minutes between marking the node as Unknown and submitting the first eviction request. 
     - API-initiated Evictionì€ Eviction APIë¥¼ ì´ìš©í•´ graceful pod terminationì„ ì‹œì‘í•˜ëŠ” eviction objectë¥¼ ë§Œë“œëŠ” í”„ë¡œì„¸ìŠ¤ë‹¤.  
     - API-initiated evictions respect your configured PodDisruptionBudgets and terminationGracePeriodSeconds
     - API ì„œë²„ì— ì˜í•´ evictionì´ í—ˆìš©ë˜ë©´ Podê°€ ì‚­ì œë˜ëŠ” ìì„¸í•œ ê³¼ì •ì€ [ë¬¸ì„œ](https://kubernetes.io/docs/concepts/scheduling-eviction/api-eviction/#how-api-initiated-eviction-works)ë¥¼ ì°¸ê³ í•œë‹¤.  
       - Podë¦¬ì†ŒìŠ¤ì— deletion timestamp ì¶”ê°€ë˜ê³  grace periodê°€ ì„¤ì •ëœë‹¤. Kubeletì€ ì¢…ë£Œë  íŒŒë“œë¥¼ ì¸ì§€í•˜ê³  gracefully shut downì„ ì‹œì‘í•œë‹¤. Kubeletì´ íŒŒë“œë¥¼ ì¢…ë£Œí•˜ëŠ” ë™ì•ˆ ì»¨íŠ¸ë¡¤í”Œë ˆì¸ì€ Endpointì™€ EndpointSlice ê°ì²´ë¥¼ ì œê±°í•œë‹¤. ê·¸ ê²°ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì€ í•´ë‹¹ íŒŒë“œê°€ ìœ íš¨í•œ ê°ì²´ê°€ ì•„ë‹˜ì„ ì•Œê²Œ ëœë‹¤. grace periodê°€ ì§€ë‚˜ë©´ kubeletì€ íŒŒë“œë¥¼ ê°•ì œë¡œ ì£µë£Œí•œë‹¤. Kubeletì€ APIì„œë²„ì— íŒŒë“œê°€ ì œê±° ë¨ì„ ì•Œë¦°ë‹¤.  

ê¸°ë³¸ì ìœ¼ë¡œ ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë…¸ë“œì˜ ìƒíƒœë¥¼ ë§¤ 5ì´ˆ(--node-monitor-period ì„¤ì •) ë§ˆë‹¤ ì²´í¬í•œë‹¤.  

![k8s-node-status](/assets/it/k8s/k8s/k8s-node-status.png){: width="80%" height="auto"}

ë‹¤ìŒì€ ì „ì²´ì ì¸ Node health checkì— ëŒ€í•œ flowì´ë©° ì•„ë˜ëŠ” ì°¸ê³ ì‚¬í•­ì´ë‹¤.  
- nodeStatusUpdateFrequency
node-status-update-frequencyì£¼ê¸°ëŠ” kubeletì´ node statusë¥¼ ê³„ì‚°í•˜ëŠ” ì£¼ê¸°ì´ë‹¤. Lease ê°ì²´ëŠ” 1.14ë²„ì „ ë¶€í„° ê¸°ëŠ¥ì´ í™œì„±í™” ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë‹¨ìˆœíˆ ê³„ì‚°ë§Œ í•˜ëŠ” ì£¼ê¸°ì´ë‹¤. 
> nodeStatusUpdateFrequency specifies how often kubelet computes node status. If node lease feature is not enabled, it is also the frequency that kubelet posts node status to master.
- Kubeletì€ leaseë¥¼ ì´ìš©í•œë‹¤. Lease ê°ì²´ëŠ” kubeletì— ì˜í•´ 10ì´ˆ ì£¼ê¸°ë¡œ renewTimeì´ ê°±ì‹ ëœë‹¤. 

<br>

## Cloud-controller-manager(Node controller)
ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” í´ë¼ìš°ë“œ Infrastructureì—ì„œ ìƒˆë¡œìš´ ì„œë²„ê°€ ìƒì„±ë  ë•Œ ë…¸ë“œ ê°ì²´ë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ë…¸ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” CSPì—ì„œ ì‹¤í–‰ë˜ëŠ” í˜¸ìŠ¤íŠ¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë©° ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.  
1. Cloud providerì˜ APIë¡œ ë¶€í„° ì–»ì€ ì„œë²„ ê³ ìœ  IDë¥¼ ë…¸ë“œ ê°ì²´ì— ì—…ë°ì´íŠ¸í•œë‹¤.  
2. Annotating and labelling the Node object with cloud-specific information, such as the region the node is deployed into and the resources (CPU, memory, etc) that it has available.
3. Obtain the node's hostname and network addresses.
4. Verifying the node's health. In case a node becomes unresponsive, this controller checks with your cloud provider's API to see if the server has been deactivated / deleted / terminated. If the node has been deleted from the cloud, the controller deletes the Node object from your Kubernetes cluster.

Some cloud provider implementations split this into a node controller and a separate node lifecycle controller.





<br><br>

## Graceful node shutdown 
Kubeletì€ ë…¸ë“œì˜ shutdownì„ ê°ì§€í•˜ê³  ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ íŒŒë“œì˜ ì¢…ë£Œë¥¼ ì‹œë„í•œë‹¤. Kubeletì€ ë…¸ë“œê°€ shutdown ë˜ëŠ”ë™ì•ˆ íŒŒë“œê°€ pod termination processë¥¼ ë”°ë¥´ë„ë¡ í•œë‹¤.  
GracefulNodeShutdownëŠ” feature gateë¥¼ í†µí•´ ì œì–´í•  ìˆ˜ ìˆë‹¤. feature gateë€ ì¿ ë²„ë„¤í‹°ìŠ¤ ê¸°ëŠ¥ì„ ì„¤ëª…í•˜ëŠ” key=value ìŒì´ë‹¤. `--feature-gates=...,GracefulNodeShutdown=true`

Defaultì„¤ì •ìœ¼ë¡œ shutdownGracePeriodì™€ shutdownGracePeriodCriticalPodsëŠ” ëª¨ë‘ 0ë¡œ ì„¤ì •ë˜ì–´ìˆìœ¼ë©° graceful node shutdown ê¸°ëŠ¥ì€ í™œì„±í™” ë˜ì–´ìˆì§€ ì•Šë‹¤. í™œì„±í™” ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” kubelet ì„¤ì •ì„ ì ì ˆíˆ ë³€ê²½í•˜ê³  0ê°’ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤.  
- shutdownGracePeriod
  - ë…¸ë“œ ì¢…ë£Œ ì§€ì—°ì‹œê°„ì˜ ì´ ì‹œê°„ì„ ì§€ì •í•œë‹¤. ì¼ë°˜ íŒŒë“œë° Critical íŒŒë“œì— ëŒ€í•œ ëª¨ë“  ì¢…ë£Œ ìœ ì˜ˆ ì‹œê°„ì´ë‹¤.  
- shutdownGracePeriodCriticalPods
  - ë…¸ë“œ ì¢…ë£Œ ì¤‘ì— CriticalíŒŒë“œë¥¼ ì¢…ë£Œí•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ì‹œê°„ì„ ì§€ì •í•œë‹¤. ì´ ê°’ì€ shutdownGracePeriod ì„¤ì • ë³´ë‹¤ ì‘ì•„ì•¼ í•œë‹¤.  

ë§Œì•½ shutdownGracePeriod ê°’ì´ 30ì´ê³  shutdownGracePeriodCriticalPods ê°’ì´ 10ì´ë©´ kubeletì€ ë…¸ë“œ ì¢…ë£Œë¥¼ 30ì´ˆ ê¹Œì§€ ì§€ì—°ì‹œí‚¤ë©° ì²˜ìŒ 20ì´ˆ ë™ì•ˆì€ ì¼ë°˜ íŒŒë“œë¥¼ ì¢…ë£Œí•˜ëŠ”ë° ë§ˆì§€ë§‰ 10ì´ˆëŠ” Critical íŒŒë“œë¥¼ ì¢…ë£Œí•˜ëŠ”ë° í• ë‹¹í•œë‹¤.  

Critical íŒŒë“œë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ PriorityClass ì„¤ì • ë° íŒŒë“œì˜ Specì— PriorityClassë¥¼ ì§€ì •í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.  
```yaml
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: 1000000
globalDefault: false
description: "This priority class should be used for XYZ service pods only."


apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    env: test
spec:
  containers:
  - name: nginx
    image: nginx
    imagePullPolicy: IfNotPresent
  priorityClassName: high-priority
```

`kubelet config YAML`
```yaml
shutdownGracePeriodByPodPriority:
  - priority: 100000
    shutdownGracePeriodSeconds: 10
  - priority: 10000
    shutdownGracePeriodSeconds: 180
  - priority: 1000
    shutdownGracePeriodSeconds: 120
  - priority: 0
    shutdownGracePeriodSeconds: 60
```

<br><br>

## Non Graceful node shutdown  
ë…¸ë“œê°€ shutdown ë˜ì—ˆì§€ë§Œ kubeletì˜ node shutdown managerê°€ ê°ì§€í•˜ì§€ ëª»í–ˆì„ ë•Œ StatefulSetì˜ íŒŒë“œëŠ” terminating ìƒíƒœë¡œ stuck ë˜ì–´ ë‹¤ë¥¸ ë…¸ë“œë¡œ ì´ë™ì´ ë˜ì§€ ëª» í•  ìˆ˜ ìˆë‹¤. Shutdown ëœ ë…¸ë“œì˜ kubeletì´ íŒŒë“œë¥¼ ì§€ìš¸ ìˆ˜ ì—†ì–´ ë™ì¼ì´ë¦„ìœ¼ë¡œ ë‹¤ë¥¸ ë…¸ë“œì— íŒŒë“œë¥¼ ë§Œë“¤ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ë§Œì•½ ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ëŠ” íŒŒë“œê°€ ìˆë‹¤ë©´ ì¢…ë£Œë˜ëŠ” ë…¸ë“œì—ì„œ VolumeAttachmentê°€ ì‚­ì œë˜ì§€ ì•Šìœ¼ë©° ìƒˆë¡œìš´ ë…¸ë“œì— ë³¼ë¥¨ì´ Attachë˜ì§€ ì•ŠëŠ”ë‹¤.  

ìœ„ ì™€ ê°™ì€ ìƒí™©ì„ ì™„í™”í•˜ê¸° ìœ„í•´, ì‚¬ìš©ìê°€ node.kubernetes.io/out-of-service taintë¥¼ NoExecute ë˜ëŠ” NoSchedule ê°’ìœ¼ë¡œ ì¶”ê°€í•˜ì—¬ ë…¸ë“œì˜ ì„œë¹„ìŠ¤ ë¶ˆê°€ìƒíƒœë¥¼ í‘œì‹œ í•  ìˆ˜ ìˆë‹¤. kube-controller-managerì— NodeOutOfServiceVolumeDetach feature gateê°€ í™œì„±í™” ë˜ì–´ìˆê³  ë…¸ë“œì— out-of-service taintê°€ ë˜ì–´ìˆë‹¤ë©´ í•´ë‹¹ ë…¸ë“œì˜ íŒŒë“œëŠ” tolerationì´ ì—†ëŠ” ê²½ìš° ê°•ì œ ì‚­ì œë˜ë©° ì¢…ë£Œë˜ëŠ” íŒŒë“œì— ëŒ€í•œ ë³¼ë¥¨ í•´ì œ ì‘ì—…ë„ ì¦‰ì‹œ ìˆ˜í–‰ëœë‹¤.  

During a non-graceful shutdown, Pods are terminated in the two phases:
1. Force delete the Pods that do not have matching out-of-service tolerations.
2. Immediately perform detach volume operation for such pods.


<br><br>

## Communication between Nodes and the Control Plane

### Node to Control Plane
ë…¸ë“œ(ë˜ëŠ” ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ íŒŒë“œ)ì—ì„œì˜ ëª¨ë“  API ì‚¬ìš©ì€ APIì„œë²„ì—ì„œ ì¢…ë£Œëœë‹¤. ë…¸ë“œëŠ” ìœ íš¨í•œ client credentialê³¼ í•¨ê»˜ APIì„œë²„ì— ì•ˆì „í•œ ì—°ê²°ì„ ìœ„í•´ public root certificateë¡œ provisionë˜ì–´ì•¼ í•œë‹¤. Client ì¸ì¦ì„œë¥¼ í†µí•´ kubeletì˜ ìê²©ì¦ëª…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ë°©ë²•ì´ë‹¤. 

### Control Plane to Node
APIì„œë²„ì—ì„œ ë…¸ë“œë¡œëŠ” ë‘ ê°€ì§€ í†µì‹  ê²½ë¡œê°€ ìˆìœ¼ë©° í•˜ë‚˜ëŠ” APIì„œë²„ì—ì„œ kubelet í”„ë¡œì„¸ìŠ¤ì´ë©° ë‘ ë²ˆì§¸ëŠ” API ì„œë²„ì—ì„œ APIì„œë²„ì˜ í”„ë¡ì‹œ ê¸°ëŠ¥ì„ ì´ìš©í•´ ë…¸ë“œ, íŒŒë“œ ë˜ëŠ” ì„œë¹„ìŠ¤ì— ì´ë¥´ëŠ” ê²ƒì´ë‹¤.

API server to kubelet 
- kubectl logs
  - Fetching logs for pods.
- kubectl exec
  - Attaching (usually through kubectl) to running pods.
- Providing the kubelet's port-forwarding functionality.

ìœ„ì™€ ê°™ì€ ì—°ê²°ì€ kubeletì˜ HTTPS endpointì—ì„œ ì¢…ë£Œë˜ë©° ê¸°ë³¸ì ìœ¼ë¡œ APIì„œë²„ëŠ” kubeletì´ ì œê³µ ì¸ì¦ì„œ(serving certificate)ë¥¼ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ëŠ” ì¤‘ê°„ì ê³µê²©ì˜ ì—°ê²°ì„ ë§Œë“œëŠ” ê²ƒì´ë©° ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” public networkì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì•ˆì „í•˜ì§€ ì•Šë‹¤.  
ì´ ì—°ê²°ì„ ê²€ì¦í•˜ê¸° ìœ„í•´ì„œëŠ” --kubelet-certificate-authority flagë¥¼ ì‚¬ìš©í•˜ì—¬ APIì„œë²„ì— kubeletì˜ serving certificateê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ”ë° root certificate bundleì„ ì œê³µí•œë‹¤.  



---

## ğŸ“š References

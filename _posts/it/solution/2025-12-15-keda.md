---
layout: post
title: "KEDAë¥¼ í†µí•œ íŒŒë“œ ìŠ¤ì¼€ì¥´ë§"
author: "Bys"
category: solution
date: 2025-12-15 01:00:00
keywords: "keda"
tags: keda
---

Ollama ë¥¼ AWS GPU ì„œë²„ì—ì„œ ë„ìš°ê¸° ì‹œì‘í•˜ë©´ì„œ ë¹„ì‹¼ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³„ì† ìƒˆë²½ì—ë„ ë‘˜ ìˆ˜ ì—†ê²Œ ë˜ì—ˆë‹¤. ë§¤ë²ˆ ì‘ì—…ì„ ì¢…ë£Œí•˜ê³  ë‚˜ë©´ Replicas ìˆ˜ë¥¼ 0ìœ¼ë¡œ ì¡°ì •í•˜ëŠ” ê²ƒì´ ê·€ì°®ì•„ì§€ê¸° ì‹œì‘í•˜ë©´ì„œ KEDA ë¥¼ í†µí•´ íŠ¹ì • ì‹œê°„ì— ìë™ ì¡°ì •ë˜ê²Œ í•˜ê³ ì í•´ë‹¹ ì†”ë£¨ì…˜ì„ ë„ì…í•œë‹¤. KEDA ê°€ ë¬´ì—‡ì¸ì§€ ê°„ë‹¨íˆ ì•Œì•„ë³´ê³  ì„¤ì¹˜ ë° ì‚¬ìš©ë°©ë²•ì— ëŒ€í•´ì„œ ì†Œê°œí•œë‹¤.  

# [KEDA](https://keda.sh/docs/2.18/concepts/)  
KEDA ëŠ” ì‹¤ì œ ì´ë²¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìŠ¤ì¼€ì¼ì„ ë„ì™€ì£¼ëŠ” ë„êµ¬ë‹¤. 


## 1. [KEDA Architecture]()  

## 2. [KEDA Install](https://keda.sh/docs/2.18/deploy/#helm)  

Helmì„ í†µí•´ KEDAë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤. [Values.yaml íŒŒì¼](https://github.com/kedacore/charts/blob/v2.18.0/keda/values.yaml)ì„ ì°¸ê³ í•´ì„œ ë°°í¬í•œë‹¤.  

```bash
helm repo add kedacore https://kedacore.github.io/charts  
helm repo update
helm install keda kedacore/keda --namespace keda --create-namespace
```

ë‚˜ì˜ ê²½ìš°ëŠ” ArgoCD ë¥¼ í†µí•´ ë°°í¬í•˜ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë°°í¬í•œë‹¤. [Github Code](https://github.com/byoungsoo/argocd-values/tree/main/dev-ap2-eks-main/keda)  
```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: keda
  namespace: argocd
spec:
  project: default
  sources:
    - repoURL: 'https://gitlab.bys.asia/bys/argocd-values.git'
      targetRevision: main
      ref: values
    - repoURL: https://kedacore.github.io/charts
      chart: keda
      targetRevision: 2.18.2
      helm:
        releaseName: keda
        valueFiles:
          - $values/dev-ap2-eks-main/keda/values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: keda
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - ServerSideApply=true
      - CreateNamespace=false
```

ArgoCDë¥¼ í†µí•´ ë°°í¬ì‹œì—ëŠ” `ServerSideApply=true` ì˜µì…˜ì„ ì¶”ê°€í•˜ì§€ ì•Šìœ¼ë©´ `scaledjobs.keda.sh` CRDê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì§€ ì•Šìœ¼ë©´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. 
```log
Failed sync attempt to : one or more objects failed to apply, reason: CustomResourceDefinition.apiextensions.k8s.io "scaledjobs.keda.sh" is invalid: metadata.annotations: Too long: may not be more than 262144 bytes (retried 5 times).
```
ì´ëŠ” Defaultë¡œ ClientSideApply ê°€ ì ìš©ë˜ë©´ì„œ `kubectl.kubernetes.io/last-applied-configuration` ì™€ ê°™ì€ ì–´ë…¸í…Œì´ì…˜ì´ í¬í•¨ë˜ì–´ ë§ì€ ë‚´ìš©ì´ ë‹´ê¸¸ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì´ë‹¤.  


## 3. Test - How to work
KEDAë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ê¸° ìœ„í•´ ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³¸ë‹¤.  

```yaml
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: default-cron-scaler  # ScaledObjectì˜ ì´ë¦„
  namespace: default       # Ollama Deploymentê°€ ë°°í¬ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤
spec:
  scaleTargetRef:
    name: nginx-test # ìŠ¤ì¼€ì¼ë§í•  Ollama Deploymentì˜ ì´ë¦„
  minReplicaCount: 0 # ìµœì†Œ ë ˆí”Œë¦¬ì¹´ ìˆ˜ (ì €ë… 6ì‹œ ì´í›„ì— 0ê°œë¡œ ì¤„ì–´ë“¤ê²Œ ë©ë‹ˆë‹¤)
  maxReplicaCount: 10 # ìµœëŒ€ ë ˆí”Œë¦¬ì¹´ ìˆ˜ (ë‚® ì‹œê°„ ë™ì•ˆ ìœ ì§€ë  ìµœëŒ€ ë ˆí”Œë¦¬ì¹´ ìˆ˜)
  pollingInterval: 30 # KEDAê°€ í¬ë¡  ìŠ¤ì¼€ì¤„ì„ í™•ì¸í•  ì£¼ê¸° (ì´ˆ ë‹¨ìœ„)
  cooldownPeriod: 300
  triggers:
  - type: cron
    metadata:
      timezone: Asia/Seoul # í•œêµ­ ì‹œê°„ëŒ€ (KST) ì„¤ì •
      # 'start' ì‹œê°„ì— 'desiredReplicas' (ì—¬ê¸°ì„œëŠ” 2)ë¡œ ìŠ¤ì¼€ì¼ ì—… (ë˜ëŠ” ìœ ì§€)ë©ë‹ˆë‹¤.
      # 'end' ì‹œê°„ ì´í›„ë¶€í„° 'start' ì‹œê°„ ì „ê¹Œì§€ëŠ” 'minReplicas' (ì—¬ê¸°ì„œëŠ” 0)ë¡œ ìŠ¤ì¼€ì¼ ë‹¤ìš´ë©ë‹ˆë‹¤.
      start: "40 11 * * *"   # ë§¤ì¼ ì•„ì¹¨ 8ì‹œ 0ë¶„ì— 2ê°œë¡œ ìŠ¤ì¼€ì¼ ì—… (ë˜ëŠ” ìœ ì§€)
      end: "50 11 * * *"  # ë§¤ì¼ ì €ë… 6ì‹œ 0ë¶„ì— ì´ 'í™œì„± ì‹œê°„ëŒ€'ê°€ ì¢…ë£Œë©ë‹ˆë‹¤. # 'end' ì‹œê°„ ì´í›„ë¶€í„° ë‹¤ìŒ 'start' ì‹œê°„ ì „ê¹Œì§€ëŠ” 'minReplicas' (0)ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤.
      desiredReplicas: "5" # 'start'ì™€ 'end' ì‚¬ì´ í™œì„± ì‹œê°„ëŒ€ì— ìœ ì§€í•  ë ˆí”Œë¦¬ì¹´ ìˆ˜
```

ì˜¤ì „ 11ì‹œ 40ë¶„ì´ ë˜ë©´ Scaling ì‘ì—…ì´ ì§„í–‰ë˜ëŠ”ë° ì–´ë–»ê²Œ ì§„í–‰ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì. 


**CloudWatch Logs Insights**    
region: ap-northeast-2    
log-group-names: /aws/eks/bys-dev-eks-main/cluster    
data-sources:     
facets:     
start-time: 2025-12-19T02:37:00.000Z    
end-time: 2025-12-19T23:59:59.000Z    
query-string:
```
fields @timestamp, user.username, verb, objectRef.resource, objectRef.name, requestObject.message
| filter @logStream like /^kube-apiserver-audit/
| filter objectRef.namespace == "default"
| filter verb not in ["list", "watch", "get"]
| filter user.username not in ["eks:az-poller"]
| filter user.username not like "system:node"
| filter objectRef.resource not in ["endpoints", "endpointslices"]
| filter objectRef.subresource not in ["status", "token"]
| filter requestObject.message not in ["istio"]
| sort @timestamp desc
```

---

| @timestamp | user.username | verb | objectRef.resource | objectRef.name | requestObject.spec.replicas | requestObject.status.desiredReplicas | requestObject.message |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 2025-12-19 02:54:44.173 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 0 |  |
| 2025-12-19 02:54:43.421 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 0 |  |  |
| 2025-12-19 02:54:42.928 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827e4f4235bbdf |  |  | Deleted pod: nginx-test-5f6f686b54-4zsrp |
| 2025-12-19 02:54:42.928 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827e4f423ea74b |  |  | Deleted pod: nginx-test-5f6f686b54-r5j4p |
| 2025-12-19 02:54:42.928 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 0 |  |  |
| 2025-12-19 02:54:42.928 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827e4f424b0db5 |  |  | Deleted pod: nginx-test-5f6f686b54-ljlns |
| 2025-12-19 02:54:42.927 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 0 |  |  |
| 2025-12-19 02:54:42.927 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827e4f41ae36c6 |  |  | Deleted pod: nginx-test-5f6f686b54-9dt8x |
| 2025-12-19 02:54:42.927 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 0 |  |  |
| 2025-12-19 02:54:42.926 | system:serviceaccount:kube-system:replicaset-controller | delete | pods | nginx-test-5f6f686b54-ljlns |  |  |  |
| 2025-12-19 02:54:42.926 | system:serviceaccount:kube-system:deployment-controller | patch | events | nginx-test.18827d528919200c |  |  | Scaled down replica set nginx-test-5f6f686b54 from 5 to 0 |
| 2025-12-19 02:54:42.926 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827e4f41a9c98e |  |  | Deleted pod: nginx-test-5f6f686b54-p9l9r |
| 2025-12-19 02:54:42.925 | system:serviceaccount:kube-system:replicaset-controller | delete | pods | nginx-test-5f6f686b54-r5j4p |  |  |  |
| 2025-12-19 02:54:42.924 | system:serviceaccount:kube-system:replicaset-controller | delete | pods | nginx-test-5f6f686b54-p9l9r |  |  |  |
| 2025-12-19 02:54:42.924 | system:serviceaccount:kube-system:replicaset-controller | delete | pods | nginx-test-5f6f686b54-4zsrp |  |  |  |
| 2025-12-19 02:54:42.923 | system:serviceaccount:kube-system:replicaset-controller | delete | pods | nginx-test-5f6f686b54-9dt8x |  |  |  |
| 2025-12-19 02:54:42.922 | system:serviceaccount:keda:keda-operator | create | events | default-cron-scaler.18827e4f3ee250e2 |  |  | Deactivated apps&#x2f;v1.Deployment default&#x2f;nginx-test from 5 to 0 |
| 2025-12-19 02:54:42.922 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 0 |  |  |
| 2025-12-19 02:54:42.921 | system:serviceaccount:kube-system:deployment-controller | update | replicasets | nginx-test-5f6f686b54 | 0 |  |  |
| 2025-12-19 02:54:42.920 | system:serviceaccount:keda:keda-operator | update | deployments | nginx-test |  |  |  |
| 2025-12-19 02:50:13.793 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 5 |  |
| 2025-12-19 02:40:43.257 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 5 |  |
| 2025-12-19 02:40:32.965 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 5 |  |  |
| 2025-12-19 02:40:32.714 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 5 |  |  |
| 2025-12-19 02:40:28.190 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 5 |  |  |
| 2025-12-19 02:40:27.946 | system:serviceaccount:kube-system:replicaset-controller | create | pods |  |  |  |  |
| 2025-12-19 02:40:27.946 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 5 |  |  |
| 2025-12-19 02:40:27.946 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 5 |  |  |
| 2025-12-19 02:40:27.946 | system:serviceaccount:kube-system:replicaset-controller | patch | events | nginx-test-5f6f686b54.18827d84be8c4474 |  |  | (combined from similar events): Created pod: nginx-test-5f6f686b54-9dt8x |
| 2025-12-19 02:40:27.944 | system:kube-scheduler | create | pods | nginx-test-5f6f686b54-9dt8x |  |  |  |
| 2025-12-19 02:40:27.944 | system:kube-scheduler | create | events | nginx-test-5f6f686b54-9dt8x.18827d88385dc064 |  |  |  |
| 2025-12-19 02:40:27.944 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 5 |  |  |
| 2025-12-19 02:40:27.944 | system:serviceaccount:kube-system:deployment-controller | patch | events | nginx-test.18827cfc99445854 |  |  | Scaled up replica set nginx-test-5f6f686b54 from 4 to 5 |
| 2025-12-19 02:40:27.944 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 5 |  |  |
| 2025-12-19 02:40:27.939 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | deployments | nginx-test | 5 |  |  |
| 2025-12-19 02:40:27.939 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 5 |  |
| 2025-12-19 02:40:27.939 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | create | events | keda-hpa-default-cron-scaler.18827d88348250fa |  |  | New size: 5; reason: external metric s0-cron-Asia-Seoul-4011xxx-5011xxx(&amp;LabelSelector{MatchLabels:map[string]string{scaledobject.keda.sh&#x2f;name: default-cron-scaler,},MatchExpressions:[]LabelSelectorRequirement{},}) above target |
| 2025-12-19 02:40:27.939 | system:serviceaccount:kube-system:deployment-controller | update | replicasets | nginx-test-5f6f686b54 | 5 |  |  |
| 2025-12-19 02:40:18.408 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:18.160 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:18.160 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:18.159 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:17.906 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:17.655 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:17.406 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:17.404 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | pods | nginx-test-5f6f686b54-4zsrp |  |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | events | nginx-test-5f6f686b54-4zsrp.18827d84b9f2a828 |  |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | pods | nginx-test-5f6f686b54-r5j4p |  |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | pods | nginx-test-5f6f686b54-ljlns |  |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | events | nginx-test-5f6f686b54-r5j4p.18827d84be553247 |  |  |  |
| 2025-12-19 02:40:13.165 | system:kube-scheduler | create | events | nginx-test-5f6f686b54-ljlns.18827d84be94dd6d |  |  |  |
| 2025-12-19 02:40:13.143 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:13.143 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:13.143 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:13.142 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827d84be8c4474 |  |  | (combined from similar events): Created pod: nginx-test-5f6f686b54-ljlns |
| 2025-12-19 02:40:13.142 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:13.142 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:13.141 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827d84b9faebe2 |  |  | Created pod: nginx-test-5f6f686b54-4zsrp |
| 2025-12-19 02:40:13.141 | system:serviceaccount:kube-system:replicaset-controller | create | pods |  |  |  |  |
| 2025-12-19 02:40:13.141 | system:serviceaccount:kube-system:replicaset-controller | create | pods |  |  |  |  |
| 2025-12-19 02:40:13.141 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827d84bdcbe32f |  |  | Created pod: nginx-test-5f6f686b54-r5j4p |
| 2025-12-19 02:40:13.141 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:12.918 | system:serviceaccount:kube-system:replicaset-controller | create | pods |  |  |  |  |
| 2025-12-19 02:40:12.911 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:12.911 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:12.910 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 4 |  |
| 2025-12-19 02:40:12.910 | system:serviceaccount:kube-system:replicaset-controller | update | replicasets | nginx-test-5f6f686b54 | 1 |  |  |
| 2025-12-19 02:40:12.910 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:12.910 | system:serviceaccount:kube-system:replicaset-controller | create | events | nginx-test-5f6f686b54.18827d84b4a88c56 |  |  | Created pod: nginx-test-5f6f686b54-p9l9r |
| 2025-12-19 02:40:12.910 | system:serviceaccount:kube-system:deployment-controller | patch | events | nginx-test.18827cf917d9b2af |  |  | Scaled up replica set nginx-test-5f6f686b54 from 1 to 4 |
| 2025-12-19 02:40:12.905 | system:serviceaccount:kube-system:replicaset-controller | create | pods |  |  |  |  |
| 2025-12-19 02:40:12.905 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | create | events | keda-hpa-default-cron-scaler.18827d84b38c0441 |  |  | New size: 4; reason: external metric s0-cron-Asia-Seoul-4011xxx-5011xxx(&amp;LabelSelector{MatchLabels:map[string]string{scaledobject.keda.sh&#x2f;name: default-cron-scaler,},MatchExpressions:[]LabelSelectorRequirement{},}) above target |
| 2025-12-19 02:40:12.896 | system:serviceaccount:kube-system:deployment-controller | update | replicasets | nginx-test-5f6f686b54 | 4 |  |  |
| 2025-12-19 02:40:12.895 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 1 |  |  |
| 2025-12-19 02:40:12.895 | system:serviceaccount:kube-system:deployment-controller | patch | events | nginx-test.18827c0ebcc1d839 |  |  | Scaled up replica set nginx-test-5f6f686b54 from 0 to 1 |
| 2025-12-19 02:40:12.895 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | deployments | nginx-test | 4 |  |  |
| 2025-12-19 02:40:12.892 | system:kube-scheduler | create | pods | nginx-test-5f6f686b54-p9l9r |  |  |  |
| 2025-12-19 02:40:12.892 | system:kube-scheduler | create | events | nginx-test-5f6f686b54-p9l9r.18827d84b44ffbaf |  |  |  |
| 2025-12-19 02:40:12.891 | system:serviceaccount:keda:keda-operator | create | events | default-cron-scaler.18827d84ad9b4772 |  |  | Scaled apps&#x2f;v1.Deployment default&#x2f;nginx-test from 0 to 1, triggered by cronScaler |
| 2025-12-19 02:40:12.891 | system:serviceaccount:kube-system:deployment-controller | update | deployments | nginx-test | 1 |  |  |
| 2025-12-19 02:40:12.890 | system:serviceaccount:kube-system:deployment-controller | update | replicasets | nginx-test-5f6f686b54 | 1 |  |  |
| 2025-12-19 02:40:12.889 | system:serviceaccount:keda:keda-operator | update | deployments | nginx-test | 1 |  |  |
| 2025-12-19 02:37:27.937 | system:serviceaccount:kube-system:horizontal-pod-autoscaler | update | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 0 |  |
| 2025-12-19 02:37:12.896 | system:serviceaccount:keda:keda-operator | patch | events | default-cron-scaler.18827d5ac3b3a812 |  |  | ScaledObject is ready for scaling |
| 2025-12-19 02:37:12.895 | system:serviceaccount:keda:keda-operator | create | horizontalpodautoscalers | keda-hpa-default-cron-scaler |  | 0 |  |
| 2025-12-19 02:37:12.895 | system:serviceaccount:keda:keda-operator | create | events | default-cron-scaler.18827d5ac3b2fd4e |  |  | Started scalers watch |
| 2025-12-19 02:37:12.895 | system:serviceaccount:keda:keda-operator | create | events | default-cron-scaler.18827d5ac3b3a812 |  |  | ScaledObject is ready for scaling |
| 2025-12-19 02:37:12.894 | system:serviceaccount:keda:keda-operator | create | events | default-cron-scaler.18827d5ac1f95e31 |  |  | Scaler cron is built |
| 2025-12-19 02:37:12.809 | arn:aws:iam::558846430793:user&#x2f;byoungsoo | create | scaledobjects | default-cron-scaler |  |  |  |

---

**CloudWatch Logs Insights**    
region: ap-northeast-2    
log-group-names: /aws/eks/bys-dev-eks-main/cluster    
data-sources:     
facets:     
start-time: 2025-12-19T02:37:00.000Z    
end-time: 2025-12-19T23:59:59.000Z    
query-string:
  ```
  fields @timestamp, @message
| filter @logStream like /^kube-controller-manager/
| FILTER @message like "keda-hpa-default-cron-scaler"
  ```
---

| @timestamp | @message |
| --- | --- |
| 2025-12-19 02:40:27.000 | I1219 02:40:27.832655      10 horizontal.go:927] &quot;Successfully rescaled&quot; logger=&quot;horizontal-pod-autoscaler-controller&quot; HPA=&quot;default&#x2f;keda-hpa-default-cron-scaler&quot; currentReplicas=4 desiredReplicas=5 reason=&quot;external metric s0-cron-Asia-Seoul-4011xxx-5011xxx(&amp;LabelSelector{MatchLabels:map[string]string{scaledobject.keda.sh&#x2f;name: default-cron-scaler,},MatchExpressions:[]LabelSelectorRequirement{},}) above target&quot; |
| 2025-12-19 02:40:12.000 | I1219 02:40:12.784139      10 horizontal.go:927] &quot;Successfully rescaled&quot; logger=&quot;horizontal-pod-autoscaler-controller&quot; HPA=&quot;default&#x2f;keda-hpa-default-cron-scaler&quot; currentReplicas=1 desiredReplicas=4 reason=&quot;external metric s0-cron-Asia-Seoul-4011xxx-5011xxx(&amp;LabelSelector{MatchLabels:map[string]string{scaledobject.keda.sh&#x2f;name: default-cron-scaler,},MatchExpressions:[]LabelSelectorRequirement{},}) above target&quot; |

---


ë™ì‘ë°©ì‹ì— ëŒ€í•´ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.  

1. AdmissionWebhook ì˜ ê²½ìš° ScaledObjectë¥¼ ë§Œë“¤ ë•Œ ê²€ì¦:
   1. scaleTargetRefê°€ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” Deployment ì¸ì§€
   2. trigger ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ 
   3. í•„ìˆ˜ í•„ë“œê°€ ë¹ ì§€ì§€ ì•Šì•˜ëŠ” ì§€ ë“±.
2. KEDA Operator ëŠ” ScaledObject ë¥¼ Watch í•˜ê³  ìˆë‹¤ê°€, ìƒˆë¡œìš´ ScaledObject ê°€ ìƒì„±ë˜ë©´ HPA ë¥¼ ìƒì„±í•œë‹¤.  
3. KEDA Operator(Scaler)ëŠ” ë©”íŠ¸ë¦­ ìˆ˜ì§‘ì„ ì‹œì‘í•œë‹¤.  
4. HPA ê°€ ë©”íŠ¸ë¦­ì„ ìš”ì²­:
   1. HPA (s0-cron-Asia-Seoul-4011xxx-5011xxx ë©”íŠ¸ë¦­ ê°’ ì•Œë ¤ì¤˜)
   2. Kubernetes API Server (External Metrics API ìš”ì²­)
   3. KEDA Metrics APIServer (Operator ì—ì„œ ê°’ ì¡°íšŒ)
5. HPA ìŠ¤ì¼€ì¼ ê°’ ê³„ì‚°
6. íŒŒë“œ ìˆ˜ ì¡°ì ˆ (* íŠ¹ì´ì : ì‚¬ì‹¤ì€ 0 -> 1 ë¡œ Replicas ìˆ˜ê°€ ì¡°ì •ë  ë•ŒëŠ” HPAê°€ ì•„ë‹Œ KEDA Operator ê°€ ì§ì ‘ Deployments ë¥¼ ìˆ˜ì •í•œë‹¤ëŠ” ì ì´ë‹¤.) 
  - `log - system:serviceaccount:keda:keda-operator     update    deployments    nginx-test    1`



## 4. Details about KEDA Metrics
KEDA Metrics ë¥¼ í†µí•´ ì™¸ë¶€ ë©”íŠ¸ë¦­ì´ ì–´ë–»ê²Œ ì¡°íšŒë˜ëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤. ì™¸ë¶€ ë©”íŠ¸ë¦­ì„ ì¡°íšŒí•˜ê¸° ìœ„í•´ KEDA Operator ë‚´ë¶€ì—ëŠ” ë‹¤ì–‘í•œ Scaler ì½”ë“œê°€ ì¡´ì¬í•œë‹¤. [KEDA Operator ì˜ Github ì½”ë“œ](https://github.com/kedacore/keda/tree/main/pkg/scalers)ì—ëŠ” `aws_cloudwatch_scaler.go, aws_dynamodb_scaler.go, aws_sqs_queue_scaler.go, ...... azure_blob_scaler.go, azure_queue_scaler.go, ...... elasticsearch_scaler.go, etcd_scaler.go, mysql_scaler.go` ë“± ë‹¤ì–‘í•œ Scaler ê°€ ì¡´ì¬í•˜ë©° ì´ Scaler ì˜ ì—­í• ì€ ì™¸ë¶€ì˜ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ” ì—­í• ì„ í•œë‹¤.  


KEDA Metrics ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.  
```bash
# kubectl get --raw "/apis/external.metrics.k8s.io/v1beta1/namespaces/{namespace}}/{metrics_name_from_hpa}?labelSelector=scaledobject.keda.sh%2Fname%3D{scaled_object_name}"

kubectl get --raw "/apis/external.metrics.k8s.io/v1beta1/namespaces/default/s0-cron-Asia-Seoul-3622xxx-5022xxx?labelSelector=scaledobject.keda.sh%2Fname%3Ddefault-cron-scaler"

# Cron ì¼ ê²½ìš° íŠ¹ì • ì‹œê°„ì´ë˜ì§€ ì•Šì„ ë•ŒëŠ” value ê°’ì´ 0!
{
  "kind": "ExternalMetricValueList",
  "apiVersion": "external.metrics.k8s.io/v1beta1",
  "metadata": {},
  "items": [
    {
      "metricName": "s0-cron-Asia-Seoul-3622xxx-5022xxx",
      "metricLabels": null,
      "timestamp": "2025-12-19T12:34:11Z",
      "value": "0"
    }
  ]
}

# Cron ì¼ ê²½ìš° íŠ¹ì • ì‹œê°„ì´ë˜ë©´ value ê°’ì´ ë³€ê²½!
{
  "kind": "ExternalMetricValueList",
  "apiVersion": "external.metrics.k8s.io/v1beta1",
  "metadata": {},
  "items": [
    {
      "metricName": "s0-cron-Asia-Seoul-3622xxx-5022xxx",
      "metricLabels": null,
      "timestamp": "2025-12-19T13:37:41Z",
      "value": "5"
    }
  ]
}
```

```bash
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ì‚¬ìš©ì/HPA                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Kubernetes API Server                           â”‚
â”‚                                                                         â”‚
â”‚   API ë¼ìš°íŒ… (APIService ë¦¬ì†ŒìŠ¤ ê¸°ë°˜)                                      â”‚
â”‚                                                                         â”‚
â”‚   /apis/metrics.k8s.io/...        â†’  K8s Metrics Server                â”‚
â”‚   /apis/external.metrics.k8s.io/...  â†’  KEDA Metrics Server            â”‚
â”‚   /apis/custom.metrics.k8s.io/...    â†’  (Prometheus Adapter ë“±)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â”‚
         â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  K8s Metrics Server â”‚              â”‚  KEDA Metrics Server     â”‚
â”‚  (kube-system)      â”‚              â”‚  (keda namespace)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚              â”‚                          â”‚
â”‚  kubeletì—ì„œ ìˆ˜ì§‘:    â”‚              â”‚  ScaledObject ê¸°ë°˜ ìˆ˜ì§‘:  â”‚
â”‚  - Pod CPU          â”‚              â”‚  - Prometheus queries    â”‚
â”‚  - Pod Memory       â”‚              â”‚  - Kafka lag             â”‚
â”‚  - Node metrics     â”‚              â”‚  - Cron triggers         â”‚
â”‚                     â”‚              â”‚  - Cloud metrics         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. ScaledObject ìƒì„±
2. KEDA Operatorê°€ HPA ìë™ ìƒì„±(External Metrics íƒ€ì…ìœ¼ë¡œ ì„¤ì •)
3. HPAê°€ ì£¼ê¸°ì ìœ¼ë¡œ ë©”íŠ¸ë¦­ ì¡°íšŒ (15ì´ˆ ê¸°ë³¸) - GET /apis/external.metrics.k8s.io/v1beta1/namespaces/{ns}/{metric-name}
4. API Serverê°€ ìš”ì²­ì„ KEDA Metrics Serverë¡œ ë¼ìš°íŒ…
5. KEDA Metrics Serverê°€ ì‹¤ì œ ì™¸ë¶€ ì†ŒìŠ¤ì—ì„œ ê°’ ì¡°íšŒ (KEDA)
6. HPAê°€ ê²°ê³¼ê°’ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ ê²°ì •



---

ë‹¤ìŒ API ì„œë²„ Audit ë¡œê·¸ë¥¼ í†µí•´ ìœ„ ì„¤ëª…ê³¼ ê°™ì´ HPA ë¡œ ë¶€í„° 15ì´ˆ ì£¼ê¸°ë¡œ API ì„œë²„ì— ë©”íŠ¸ë¦­ì´ ìš”ì²­(/apis/external.metrics.k8s.io/v1beta1/namespaces/default/s0-cron-asia-seoul-3622xxx-5022xxx?labelSelector=scaledobject.keda.sh%2Fname%3Ddefault-cron-scaler) ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. 

**CloudWatch Logs Insights**    
region: ap-northeast-2    
log-group-names: /aws/eks/bys-dev-eks-main/cluster    
data-sources:     
facets:     
start-time: 2025-12-19T02:37:00.000Z    
end-time: 2025-12-19T23:59:59.000Z    
query-string:
  ```
  fields @timestamp, userAgent, verb, objectRef.resource
| filter @logStream like "kube-apiserver-audit" 
| filter requestURI like "/apis/external.metrics.k8s.io/v1beta1"
| filter objectRef.resource like "s0-cron-"
| sort @timestamp desc
  ```

---

| @timestamp | userAgent | verb | objectRef.resource |
| --- | --- | --- | --- |
| 2025-12-19 02:42:13.103 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:41:58.042 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:41:43.240 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:41:28.193 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:41:13.397 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:40:58.065 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:40:43.006 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:40:27.939 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |
| 2025-12-19 02:40:12.895 | kube-controller-manager&#x2f;v1.34.1 (linux&#x2f;amd64) kubernetes&#x2f;2011049&#x2f;system:serviceaccount:kube-system:horizontal-pod-autoscaler | list | s0-cron-asia-seoul-4011xxx-5011xxx |

---

---

## ğŸ“š References

[1] **KEDA**
- https://keda.sh/docs/2.18/concepts/

[2] **KEDA Github**
- https://github.com/kedacore/keda/tree/main/pkg/scalers

[3] **KEDA Chart**
- https://github.com/kedacore/charts/blob/main/keda